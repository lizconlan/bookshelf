<% if @book.class == BookBundle
  block = "section"
  title_class = "h3"
else
  block = "article"
  title_class = "h2"
end %>
<<%= block %> class="book" itemscope="" itemtype="http://schema.org/Book">
  <<%= title_class %> class="title">
    <a href="<%= @book.link %>">
      <%= @book.title %>
    </a>
  </<%= title_class %>>
  <% if @book.cover_pic %>
    <img itemprop="image" src="<%= @book.cover_pic %>" alt=""/>
  <% end %>
  <section class="about">
    <% unless @book.notes.nil? %>
      <span class="notes"><%= @book.notes %></span>
      <br /><br />
    <% end %>
    <span class="authors"><%= @book.authors.join(", ") %></span> <br />
    <span class="publisher"><%= @book.publisher %></span> <br />
    <% unless @book.isbn.empty? %>
      <span class="isbn isbn_<%= @book.isbn %>"><%= @book.isbn %></span>
      <% targeturl = "https://openlibrary.org/api/books?bibkeys=ISBN:" + @book.isbn.tr(' ','') + "&jscmd=data&format=json" %>

      <script>$.getJSON('<%= targeturl %>', function(openLibJson){
          if (_.isEmpty(openLibJson)) {
//           console.log('No OpenLibrary data for ISBN: <%= @book.isbn %>');
          } else {
//           console.log(openLibJson);
          var isbn_key = _.keys(openLibJson)[0];
          $('span.isbn_<%= @book.isbn %>').append('<br><time>Published: ' + openLibJson[isbn_key].publish_date + '</time>');
          $('span.isbn_<%= @book.isbn %>').append('<br><span>' + openLibJson[isbn_key].number_of_pages + 'pp.</span>');
          }
      })</script>
    <% end %>

    <ul class="formats">
    
      <% @book.formats.each do |format| %>
      
        <li> <i class="fa fa-file-pdf-o"></i> <a href='ibooks://<%= format[:link] %>'><%= format[:name] %></a></li>
      <% end %>
    </ul>
  </section><br clear='all'>
</<%= block %>>